{
    email your-email@example.com
    admin off
}

################################################################################
# MAIN SITE  ─ https + automatic HTTP→HTTPS redir handled by Caddy itself
################################################################################
:443 {
    tls {
        protocols tls1.2 tls1.3
    }

    handle /api/*   { reverse_proxy api:8000 }
    handle /docs    { reverse_proxy api:8000 }
    handle /redoc   { reverse_proxy api:8000 }
    handle /minio/* { reverse_proxy minio:9001 }

    handle {
        file_server {
            root /app/assets
        }
    }
}

################################################################################
# FASTAPI OVER THE BARE IP (OPTIONAL)
################################################################################
23.88.121.164 {
    reverse_proxy api:8000 {
        header_up X-Real-IP {remote_host}
    }
}

################################################################################
# MINIO ***HTTPS*** FRONT-DOOR  → fixes mixed-content
################################################################################
files.23-88-121-164.nip.io {
    reverse_proxy http://minio:9000
    header_up Host {http.request.host}
}

# Optional: redirect the plain-HTTP version to HTTPS
http://files.23-88-121-164.nip.io {
    redir https://{host}{uri}
}

################################################################################
# (Optional helpers still available over HTTP)
################################################################################
minio-console.23.88.121.164 { reverse_proxy minio:9001 }
minio-api.23.88.121.164     { reverse_proxy minio:9000 }
