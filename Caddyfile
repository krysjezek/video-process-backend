{
    email your-email@example.com
    admin off
}

# Redirect HTTP to HTTPS
:80 {
    redir https://{host}{uri} permanent
}

# Main domain
:443 {
    tls {
        protocols tls1.2 tls1.3
    }

    # API endpoint
    handle /api/* {
        reverse_proxy api:8000
    }

    # Swagger UI
    handle /docs {
        reverse_proxy api:8000
    }

    handle /redoc {
        reverse_proxy api:8000
    }

    # MinIO console
    handle /minio/* {
        reverse_proxy minio:9001
    }

    # Serve static files
    handle {
        file_server {
            root /app/assets
        }
    }
}

# API service
api.video-process.23.88.121.164.nip.io {
    reverse_proxy api:8000 {
        header_up X-Real-IP {remote_host}
    }
}

# MinIO console
minio-console.video-process.23.88.121.164.nip.io {
    reverse_proxy minio:9001
}

# MinIO API
minio-api.video-process.23.88.121.164.nip.io {
    reverse_proxy minio:9000 {
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-Proto https
    }
} 